# 四代编译器

## 实验要求

四代编译器能够处理的文法如下所示。

- 关键字：`int`, `return`, `main`, `void`
  `if`, `else`, `while`, `continue`, `break`
- 标识符：符合 C89 标准的标识符（`[A-Za-z_][0-9A-Za-z_]*`）
- 常量：十进制整型，如 `1`、 `223`、 `10` 等
- 赋值操作符：`=`
- 运算符：
    - 一元运算符：`- ! ~`
    - 二元运算符：`+ - * / % < <= > >= == != & | ^ && ||`
- 标点符号：`; { } ( )`
- 语句：
    - 变量声明（多变量、初始化） `int a, b=111, c=1+3;`
    - 复杂表达式赋值语句  `a = (d+b&1)/(e!=3^b/c&&d); a = b+c;`
    - return 语句（可能为常数、变量、表达式） `return a+b; return func(a);`
    - 函数调用 `println_int(a+b);`
    - 条件语句 `if ( condition ) { ... }`
      `if ( condition ) { ... } else { ... }`
    - 循环语句 `while ( condition ) { ... }`
    - 循环控制语句 `continue; break;`
- 函数定义：
    - 不带参数 `int func(){...}` `void func() {...}`
    - 带参数（可能为常数、变量、表达式） `int func(int a, int b){...}` `void func(int a, int b){...}`
- 预置函数：在自定义函数外，还需支持对预置函数的调用。
    - `println_int(int a)` 与 C 语言中 `printf("%d\n", a)` 有相同输出

## 实验分工

## 实验设计

详细的还是请参见另一份文档以及源代码中的注释吧。

### 技术路线：

Source Code $\xrightarrow{Lexer}$ Tokens $\xrightarrow{Parser}$ Parse Tree (statements etc.) & AST (expressions) $\xrightarrow{Code\ Generator}$ Assembly Code

用 Flex 来写 Lexer，用 Bison 来写 Parser，Parser 与 Code Generator 相结合，对于一般语句可以直接生成代码，对于表达式会先构造抽象语法树（AST），再通过遍历结点生成代码。

### 源码结构：

代码的文件框架参考自 [Part 6: Variables](https://github.com/DoctorWkt/acwj/tree/master/06_Variables)，如下：

```Bash
src
├─ CMakeLists.txt					# CMake 编译用
├─ CMakeLists-评测用.txt					# CMake 评测用的简易版本，需改名
├─ MyBison.tab.c					# ⚠ 自动生成，无须手动修改
├─ MyBison.tab.h					# ⚠ 自动生成，无须手动修改
├─ MyBison.y		# Parser
├─ MyFlex.l		# Scanner/Lexer
├─ ast.cpp		# AST 结构
├─ build.sh						# Build on Linux
├─ cases						# 样例文件夹
│  ├─ e01.c
│  ├─ e02.c
│  ├─ e03.c
│  └─ e04.c
├─ codegen.cpp		# MIPS 代码生成，针对具体指令
├─ declare.h		# 头文件，声明各函数
├─ defs.h		# 头文件，定义一些复合类型数据
├─ gen.cpp		# 泛用代码生成
├─ lex.yy.c						# ⚠ 自动生成，无须手动修改
├─ main.cpp		# 主函数，程序入口
├─ run.cmd						# Build & Run on Windows
├─ stmt.cpp		# 语句相关代码生成
└─ symtab.cpp		# 符号表，变量、函数相关
```

©generated by [Project Tree Generator](https://woochanleee.github.io/project-tree-generator)

在从借鉴到改造 acwj 框架的过程中，各文件原本应有的良好的隔离性遭到了破坏，尤其 `codegen.cpp`, `gen.cpp`, `stmt.cpp` 在封装、调用上尚未打磨，分工多有重叠，有待改进。

## 实验结果

![lab3_3rd_AC_8.png](./img/lab3_3rd_AC_8.png)

## 实验总结与反思
